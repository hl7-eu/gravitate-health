<?xml version="1.0" encoding="UTF-8"?>

<OperationDefinition xmlns="http://hl7.org/fhir">
  <id value="focus"/>
  <text>
    <status value="extensions"/><div xmlns="http://www.w3.org/1999/xhtml"><p>URL: [base]/$focus</p><p>Parameters</p><table class="grid"><tr><td><b>Use</b></td><td><b>Name</b></td><td><b>Scope</b></td><td><b>Cardinality</b></td><td><b>Type</b></td><td><b>Binding</b></td><td><b>Documentation</b></td></tr><tr><td>IN</td><td>ips</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/datatypes.html#base64Binary">base64Binary</a></td><td/><td><div><p>IPS bundle packaged as base64Binary in order not to mix FHIR R4 with FHIR R5.</p>
</div></td></tr><tr><td>IN</td><td>ips-identifier</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/datatypes.html#Identifier">Identifier</a></td><td/><td><div><p>IPS Patient Identifier</p>
</div></td></tr><tr><td>IN</td><td>epi</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/bundle.html">Bundle</a></td><td/><td><div><p>ePI Document Bundle</p>
</div></td></tr><tr><td>IN</td><td>epi-identifier</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/datatypes.html#Identifier">Identifier</a></td><td/><td><div><p>ePI Document Identifier</p>
</div></td></tr><tr><td>IN</td><td>pv</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/bundle.html">Bundle</a></td><td/><td><div><p>Persona Vector</p>
</div></td></tr><tr><td>IN</td><td>pv-identifier</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/datatypes.html#Identifier">Identifier</a></td><td/><td><div><p>Persona Vector Identifier</p>
</div></td></tr><tr><td>IN</td><td>language</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/datatypes.html#Coding">Coding</a></td><td/><td><div><p>Language of the ePI. The code must be picked from https://hl7.org/fhir/valueset-languages.html. Defaults to english if none is provided.</p>
</div></td></tr><tr><td>OUT</td><td>returnEpi</td><td/><td>1..1</td><td><a href="http://hl7.org/fhir/R5/bundle.html">Bundle</a></td><td/><td><div><p>Focused epi Bundle</p>
</div></td></tr><tr><td>OUT</td><td>returnEpiExtracts</td><td/><td>0..1</td><td><a href="http://hl7.org/fhir/R5/bundle.html">Bundle</a></td><td/><td><div><p>Focused epi Bundle extracts</p>
</div></td></tr></table></div>
  </text>
  <url value="http://hl7.eu/fhir/ig/gravitate-health/OperationDefinition/focus"/>
  <version value="0.1.0"/>
  <name value="focus"/>
  <title value="focus"/>
  <status value="active"/>
  <kind value="operation"/>
  <date value="2024-03-14T09:41:47+00:00"/>
  <publisher value="Gravitate Health Project"/>
  <contact>
    <name value="Gravitate Health Project"/>
    <telecom>
      <system value="url"/>
      <value value="https://www.gravitatehealth.eu/"/>
    </telecom>
  </contact>
  <contact>
    <name value="Gravitate Health Project"/>
    <telecom>
      <system value="url"/>
      <value value="https://www.gravitatehealth.eu/"/>
    </telecom>
  </contact>
  <description value="This operation calculates a focused version of an ePI as well as the separate extracts. The IPS can either be submitted as an IPS bundle or as an `Identifer` of the patient (using the `ips-identifier` parameter). If neither IPS Bundle or IPS identifier are passed as parameters it is expected that the `Identifier` of the patient is present as part of the security token. If the `Identifier` of the patient is submitted as an Identifier or as part of a security token it is up to the discression of the service implementing the `focus`-operation to fetch the IPS of the patient.&#xA;&#xA;If the IPS is delivered as a bundle it must be encoded using Base64 as it is FHIR R4 compliant whereas the `focus`-operation is FHIR R5 compliant. The `focus`-operation will internally convert and extract the needed information from the R4 bundle.&#xA;&#xA;The ePI can be delivered either as a `Bundle` or by using an `Identifier` of the bundle. Whether the support of both `Identifier` and `Bundle` continues to be supported currently remains unknown.&#xA;&#xA;The persona dimension can be delivered either as a `Bundle` or by using an `Identifier` of the bundle. Whether the support of both `Identifier` and `Bundle` continues to be supported currently remains unknown.&#xA;&#xA;**Note: If the IPS is delivered as encoded Base64 content, there is a better opportunity for the submitting client to de-identify the Patient resource as the client can remove the Patient.identifier and mask out names and so on. While this may seem counter intuitive from an IPS point of view, the Patient identifiable components are not needed for the focusing mechanism to operate properly.**&#xA;"/>
  <affectsState value="false"/>
  <code value="focus"/>
  <system value="true"/>
  <type value="false"/>
  <instance value="false"/>
  <parameter>
    <name value="ips"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="IPS bundle packaged as base64Binary in order not to mix FHIR R4 with FHIR R5."/>
    <type value="base64Binary"/>
  </parameter>
  <parameter>
    <name value="ips-identifier"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="IPS Patient Identifier"/>
    <type value="Identifier"/>
  </parameter>
  <parameter>
    <name value="epi"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="ePI Document Bundle"/>
    <type value="Bundle"/>
  </parameter>
  <parameter>
    <name value="epi-identifier"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="ePI Document Identifier"/>
    <type value="Identifier"/>
  </parameter>
  <parameter>
    <name value="pv"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="Persona Vector"/>
    <type value="Bundle"/>
  </parameter>
  <parameter>
    <name value="pv-identifier"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="Persona Vector Identifier"/>
    <type value="Identifier"/>
  </parameter>
  <parameter>
    <name value="language"/>
    <use value="in"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="Language of the ePI. The code must be picked from https://hl7.org/fhir/valueset-languages.html. Defaults to english if none is provided."/>
    <type value="Coding"/>
  </parameter>
  <parameter>
    <name value="returnEpi"/>
    <use value="out"/>
    <min value="1"/>
    <max value="1"/>
    <documentation value="Focused epi Bundle"/>
    <type value="Bundle"/>
  </parameter>
  <parameter>
    <name value="returnEpiExtracts"/>
    <use value="out"/>
    <min value="0"/>
    <max value="1"/>
    <documentation value="Focused epi Bundle extracts"/>
    <type value="Bundle"/>
  </parameter>
</OperationDefinition>